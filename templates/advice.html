{% extends "base.html" %}
{% block content %}
<div class="card">
    <h2>2Pickã‚¢ãƒ‰ãƒã‚¤ã‚¹</h2>
    <p>ã‚«ãƒ¼ãƒ‰åã¾ãŸã¯IDã§å…¥åŠ›ã§ãã¾ã™ã€‚å…¥åŠ›ä¸­ã«å€™è£œãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
    
    <form method="POST">
        <div class="form-group">
            <label for="candidate1">å€™è£œã‚«ãƒ¼ãƒ‰1:</label>
            <input type="text" id="candidate1" name="candidate1" required 
                   placeholder="ä¾‹: äºŒåˆ€ã®ã‚´ãƒ–ãƒªãƒ³ ã¾ãŸã¯ 10201110">
        </div>
        
        <div class="form-group">
            <label for="candidate2">å€™è£œã‚«ãƒ¼ãƒ‰2:</label>
            <input type="text" id="candidate2" name="candidate2" required 
                   placeholder="ä¾‹: ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ã‚¨ãƒ«ãƒ•ãƒ»ãƒ¡ã‚¤ ã¾ãŸã¯ 10012110">
        </div>
        
        <div class="form-group">
            <label for="deck_input">ç¾åœ¨ã®ãƒ‡ãƒƒã‚­ (ã‚«ãƒ¼ãƒ‰åã¾ãŸã¯IDã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š):</label>
            <textarea id="deck_input" name="deck_input" rows="3" 
                      placeholder="ä¾‹: ä¸å±ˆã®ãƒ•ã‚¡ã‚¤ã‚¿ãƒ¼, ãƒ™ãƒ«ã‚¨ãƒ³ã‚¸ã‚§ãƒ«ãƒ»ãƒªã‚¢, 10101110"></textarea>
        </div>
        
        <div style="display: flex; gap: 1rem;">
            <div class="form-group" style="flex: 1;">
                <label for="pick_index">ãƒ”ãƒƒã‚¯ç•ªå·:</label>
                <input type="number" id="pick_index" name="pick_index" value="1" min="1" max="15">
            </div>
            <div class="form-group" style="flex: 1;">
                <label for="rerolls_left">æ®‹ã‚Šãƒªãƒ­ãƒ¼ãƒ«:</label>
                <input type="number" id="rerolls_left" name="rerolls_left" value="2" min="0" max="5">
            </div>
        </div>
        
        <button type="submit" class="btn">ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’å–å¾—</button>
    </form>
</div>

{% if error_message %}
<div class="alert alert-error">{{ error_message }}</div>
{% endif %}

{% if advice_result %}
<div class="card">
    <h3>ğŸ“‹ ã‚¢ãƒ‰ãƒã‚¤ã‚¹çµæœ</h3>
    
    <div style="font-size: 1.2em; margin: 1rem 0; padding: 1rem; background: #f0f8ff; border-radius: 8px;">
        <strong>æ¨å¥¨: {{ advice_result.action_text }}</strong>
        <span style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; margin-left: 1rem; font-size: 0.9em;">
            ä¿¡é ¼åº¦: {{ advice_result.confidence }}%
        </span>
    </div>
    
    {% if advice_result.deck_info %}
    <div class="alert alert-info">{{ advice_result.deck_info }}</div>
    {% endif %}
    
    <h4>æ¨å¥¨ç†ç”±:</h4>
    <ul style="margin: 1rem 0; padding-left: 2rem;">
        {% for reason in advice_result.reasoning %}
        <li style="margin: 0.5rem 0;">{{ reason }}</li>
        {% endfor %}
    </ul>
    
    <h4>å„ã‚«ãƒ¼ãƒ‰ã®è©•ä¾¡:</h4>
    <div style="overflow-x: auto;">
        <table>
            <tr>
                <th>ã‚«ãƒ¼ãƒ‰å</th><th>ã‚³ã‚¹ãƒˆ</th><th>æœ€çµ‚ã‚¹ã‚³ã‚¢</th>
                <th>åŸºæœ¬</th><th>ã‚«ãƒ¼ãƒ–</th><th>å½¹å‰²</th><th>ã‚·ãƒŠã‚¸ãƒ¼</th><th>æˆ¦ç•¥</th><th>é‡è¤‡</th>
            </tr>
            {% for score in advice_result.card_scores %}
            <tr>
                <td><strong>{{ score.name }}</strong></td>
                <td>{{ score.cost }}</td>
                <td style="font-weight: bold; color: var(--primary);">{{ score.final_score }}</td>
                <td>{{ score.base_score }}</td>
                <td style="color: {{ '#48bb78' if score.curve_bonus >= 0 else '#f56565' }};">
                    {{ '+%.1f' % score.curve_bonus if score.curve_bonus >= 0 else '%.1f' % score.curve_bonus }}
                </td>
                <td style="color: {{ '#48bb78' if score.role_bonus >= 0 else '#f56565' }};">
                    {{ '+%.1f' % score.role_bonus if score.role_bonus >= 0 else '%.1f' % score.role_bonus }}
                </td>
                <td style="color: {{ '#48bb78' if score.synergy_bonus >= 0 else '#f56565' }};">
                    {{ '+%.1f' % score.synergy_bonus if score.synergy_bonus >= 0 else '%.1f' % score.synergy_bonus }}
                    {% if score.synergy_reasons %}
                        <br><small style="color: #666;">{{ score.synergy_reasons[0] if score.synergy_reasons else '' }}</small>
                    {% endif %}
                </td>
                <td style="color: {{ '#48bb78' if score.archetype_bonus >= 0 else '#f56565' }};">
                    {{ '+%.1f' % score.archetype_bonus if score.archetype_bonus >= 0 else '%.1f' % score.archetype_bonus }}
                </td>
                <td style="color: {{ '#48bb78' if score.duplication_penalty >= 0 else '#f56565' }};">
                    {{ '+%.1f' % score.duplication_penalty if score.duplication_penalty >= 0 else '%.1f' % score.duplication_penalty }}
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>
{% endif %}
{% endblock %}
