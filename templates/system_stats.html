{% extends "base.html" %}
{% block content %}
<div class="card">
    <h2>📊 システム統計</h2>
    
    <!-- データベース統計 -->
    <h3>💾 データベース</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1rem 0;">
        <div style="background: #f7fafc; padding: 1rem; border-radius: 8px; text-align: center;">
            <div style="font-size: 2em; font-weight: bold; color: var(--primary);">{{ stats.database.total_cards }}</div>
            <div>総カード数</div>
        </div>
        <div style="background: #f7fafc; padding: 1rem; border-radius: 8px; text-align: center;">
            <div style="font-size: 2em; font-weight: bold; color: var(--primary);">{{ stats.database.total_metrics }}</div>
            <div>評価済みカード</div>
        </div>
    </div>
    
    <!-- キャッシュ統計 -->
    <h3>⚡ キャッシュ</h3>
    <div style="background: #f9f9f9; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
            <div>
                <strong>サイズ:</strong> {{ stats.cache.size }}/{{ stats.cache.max_size }}
            </div>
            <div>
                <strong>ヒット率:</strong> {{ '%.1f' % (stats.cache.hit_rate * 100) }}%
            </div>
            <div>
                <strong>総リクエスト:</strong> {{ stats.cache.total_requests }}
            </div>
        </div>
        
        <button onclick="clearCache()" class="btn" style="background: var(--warning); margin-top: 1rem;">
            キャッシュクリア
        </button>
    </div>
    
    <!-- メタ情報 -->
    <h3>📈 メタ環境</h3>
    <div class="alert alert-info">
        <strong>{{ stats.meta_info.meta_description }}</strong>
        <br>ティア: {{ stats.meta_info.tier_info }}
        <br>最終更新: {{ stats.meta_info.last_updated }}
    </div>
</div>

<script>
function clearCache() {
    if (confirm('キャッシュをクリアしますか？')) {
        fetch('/api/cache/clear', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'}
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
            if (data.success) {
                location.reload();
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('エラーが発生しました');
        });
    }
}
</script>
{% endblock %}
