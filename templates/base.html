<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ã‚·ãƒ£ãƒ‰ãƒWB 2Pickã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼{% endblock %}</title>
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #48bb78;
            --warning: #ed8936;
            --error: #f56565;
            --bg: #f7fafc;
            --card-bg: #ffffff;
            --text: #2d3748;
            --border: #e2e8f0;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Meiryo', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .nav {
            background: #2d3748;
            padding: 0;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .nav a {
            color: white;
            text-decoration: none;
            padding: 1rem 1.5rem;
            display: block;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .nav a:hover, .nav a.active {
            background: var(--primary);
            border-bottom-color: white;
        }
        
        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text);
        }
        
        input, textarea, select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            background: var(--primary);
            color: white;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-block;
            text-decoration: none;
        }
        
        .btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid;
        }
        
        .alert-error {
            background: #fed7d7;
            border-color: var(--error);
            color: #c53030;
        }
        
        .alert-success {
            background: #c6f6d5;
            border-color: var(--success);
            color: #2f855a;
        }
        
        .alert-info {
            background: #bee3f8;
            border-color: var(--primary);
            color: #2c5282;
        }
        
        /* æ¤œç´¢ã‚µã‚¸ã‚§ã‚¹ãƒˆ */
        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border);
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .suggestion-item {
            padding: 0.75rem;
            cursor: pointer;
            border-bottom: 1px solid #f1f1f1;
            transition: background 0.2s;
        }
        
        .suggestion-item:hover {
            background: #f7fafc;
        }
        
        .suggestion-item:last-child {
            border-bottom: none;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        th, td {
            border: 1px solid var(--border);
            padding: 0.75rem;
            text-align: left;
        }
        
        th {
            background: #f7fafc;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .container { padding: 0 0.5rem; }
            .card { padding: 1rem; }
            .nav { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ´ ã‚·ãƒ£ãƒ‰ã‚¦ãƒãƒ¼ã‚¹ WB 2Pick ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼</h1>
        <p>åå‰æ¤œç´¢å¯¾å¿œãƒ»é«˜æ©Ÿèƒ½ç‰ˆ</p>
    </div>
    <div class="nav">
        <a href="/">ãƒ›ãƒ¼ãƒ </a>
        <a href="/search">ã‚«ãƒ¼ãƒ‰æ¤œç´¢</a>
        <a href="/advice">2Pickã‚¢ãƒ‰ãƒã‚¤ã‚¹</a>
        <a href="/deck_analyzer">ãƒ‡ãƒƒã‚­åˆ†æ</a>
        <a href="/win_prediction">å‹ç‡äºˆæ¸¬</a>
        <a href="/meta_info">ãƒ¡ã‚¿æƒ…å ±</a>
        <a href="/system_stats">ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆ</a>
    </div>
    <div class="container">
        {% block content %}{% endblock %}
    </div>
    
    <script>
        // æ¤œç´¢ã‚µã‚¸ã‚§ã‚¹ãƒˆæ©Ÿèƒ½
        function setupSuggestions(inputId) {
            const input = document.getElementById(inputId);
            if (!input) return;
            
            const container = input.parentElement;
            let suggestionsDiv = null;
            let currentFocus = -1;
            
            input.addEventListener('input', async function() {
                const query = this.value.trim();
                if (query.length < 2) {
                    hideSuggestions();
                    return;
                }
                
                try {
                    const response = await fetch(`/api/search_suggestions?q=${encodeURIComponent(query)}`);
                    const suggestions = await response.json();
                    showSuggestions(suggestions);
                } catch (error) {
                    console.error('æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
                }
            });
            
            input.addEventListener('keydown', function(e) {
                const items = suggestionsDiv ? suggestionsDiv.querySelectorAll('.suggestion-item') : [];
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    currentFocus = Math.min(currentFocus + 1, items.length - 1);
                    updateFocus(items);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    currentFocus = Math.max(currentFocus - 1, -1);
                    updateFocus(items);
                } else if (e.key === 'Enter' && currentFocus >= 0) {
                    e.preventDefault();
                    items[currentFocus].click();
                } else if (e.key === 'Escape') {
                    hideSuggestions();
                }
            });
            
            function showSuggestions(suggestions) {
                hideSuggestions();
                
                if (suggestions.length === 0) return;
                
                suggestionsDiv = document.createElement('div');
                suggestionsDiv.className = 'suggestions';
                
                suggestions.forEach((suggestion, index) => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    item.innerHTML = `
                        <strong>${suggestion.name}</strong>
                        <small style="color: #666; margin-left: 0.5rem;">
                            ${suggestion.class_name} ${suggestion.cost}ã‚³ã‚¹ãƒˆ ${suggestion.rarity}
                        </small>
                    `;
                    
                    item.addEventListener('click', function() {
                        input.value = suggestion.name;
                        hideSuggestions();
                        input.focus();
                    });
                    
                    suggestionsDiv.appendChild(item);
                });
                
                container.appendChild(suggestionsDiv);
                currentFocus = -1;
            }
            
            function hideSuggestions() {
                if (suggestionsDiv) {
                    suggestionsDiv.remove();
                    suggestionsDiv = null;
                }
                currentFocus = -1;
            }
            
            function updateFocus(items) {
                items.forEach((item, index) => {
                    item.style.backgroundColor = index === currentFocus ? '#e2e8f0' : '';
                });
            }
            
            // å¤–éƒ¨ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
            document.addEventListener('click', function(e) {
                if (!container.contains(e.target)) {
                    hideSuggestions();
                }
            });
        }
        
        // æ—¢å­˜ã®JavaScriptã«è¿½åŠ 
        document.addEventListener('DOMContentLoaded', function() {
            // æ—¢å­˜ã®setupSuggestionså‘¼ã³å‡ºã—
            setupSuggestions('query');
            setupSuggestions('candidate1');
            setupSuggestions('candidate2');
            
            // å…¥åŠ›è‡ªå‹•ä¿å­˜æ©Ÿèƒ½ã‚’è¿½åŠ 
            setupAutoSave();
        });

        function setupAutoSave() {
            // ãƒ‡ãƒƒã‚­å…¥åŠ›ã®è‡ªå‹•ä¿å­˜ãƒ»å¾©å…ƒ
            const deckInput = document.getElementById('deck_input');
            if (deckInput) {
                // ä¿å­˜ã•ã‚ŒãŸå€¤ã‚’å¾©å…ƒ
                const savedDeck = localStorage.getItem('sv2pick_last_deck');
                if (savedDeck) {
                    deckInput.value = savedDeck;
                    // å¾©å…ƒã•ã‚ŒãŸã“ã¨ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥
                    const notice = document.createElement('small');
                    notice.style.color = '#666';
                    notice.textContent = 'å‰å›å…¥åŠ›å†…å®¹ã‚’å¾©å…ƒã—ã¾ã—ãŸ';
                    deckInput.parentElement.appendChild(notice);
                }
                
                // å…¥åŠ›å†…å®¹ã‚’è‡ªå‹•ä¿å­˜
                deckInput.addEventListener('input', function() {
                    localStorage.setItem('sv2pick_last_deck', this.value);
                });
            }
            
            // ãƒ”ãƒƒã‚¯ç•ªå·ã¨ãƒªãƒ­ãƒ¼ãƒ«å›æ•°ã®ä¿å­˜ãƒ»å¾©å…ƒ
            const pickIndex = document.getElementById('pick_index');
            const rerollsLeft = document.getElementById('rerolls_left');
            
            if (pickIndex) {
                const savedPickIndex = localStorage.getItem('sv2pick_pick_index');
                if (savedPickIndex) pickIndex.value = savedPickIndex;
                
                pickIndex.addEventListener('change', function() {
                    localStorage.setItem('sv2pick_pick_index', this.value);
                });
            }
            
            if (rerollsLeft) {
                const savedRerolls = localStorage.getItem('sv2pick_rerolls');
                if (savedRerolls) rerollsLeft.value = savedRerolls;
                
                rerollsLeft.addEventListener('change', function() {
                    localStorage.setItem('sv2pick_rerolls', this.value);
                });
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å¾Œã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setupSuggestions('query');
            setupSuggestions('candidate1');
            setupSuggestions('candidate2');
        });
    </script>
</body>
</html>
