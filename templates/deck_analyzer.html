{% extends "base.html" %}
{% block content %}
<div class="card">
    <h2>ãƒ‡ãƒƒã‚­åˆ†æ</h2>
    <p>ç¾åœ¨ã®ãƒ‡ãƒƒã‚­æ§‹æˆã‚’åˆ†æã—ã€æ”¹å–„ææ¡ˆã‚’æä¾›ã—ã¾ã™ã€‚</p>
    
    <form method="POST">
        <div class="form-group">
            <label for="deck_input">ãƒ‡ãƒƒã‚­å†…å®¹ (ã‚«ãƒ¼ãƒ‰åã¾ãŸã¯IDã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š):</label>
            <textarea id="deck_input" name="deck_input" rows="8" required
                      placeholder="ä¾‹: ä¸å±ˆã®ãƒ•ã‚¡ã‚¤ã‚¿ãƒ¼, ãƒ™ãƒ«ã‚¨ãƒ³ã‚¸ã‚§ãƒ«ãƒ»ãƒªã‚¢, åˆ¹é‚£ã®ã‚¯ã‚¤ãƒƒã‚¯ãƒ–ãƒ¬ã‚¤ãƒ€ãƒ¼, 10101110, ..."></textarea>
            <small style="color: #666;">ã‚«ãƒ¼ãƒ‰åã¾ãŸã¯IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚30æšã¾ã§åˆ†æã§ãã¾ã™ã€‚</small>
        </div>
        
        <button type="submit" class="btn">ãƒ‡ãƒƒã‚­ã‚’åˆ†æ</button>
    </form>
</div>

{% if error_message %}
<div class="alert alert-error">{{ error_message }}</div>
{% endif %}

{% if analysis_result %}
<div class="card">
    <h3>ğŸ“Š ãƒ‡ãƒƒã‚­åˆ†æçµæœ</h3>
    
    <!-- åŸºæœ¬æƒ…å ± -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1rem 0;">
        <div style="background: #f7fafc; padding: 1rem; border-radius: 8px; text-align: center;">
            <div style="font-size: 2em; font-weight: bold; color: var(--primary);">{{ analysis_result.total_cards }}</div>
            <div>ç·ã‚«ãƒ¼ãƒ‰æ•°</div>
        </div>
        <div style="background: #f7fafc; padding: 1rem; border-radius: 8px; text-align: center;">
            <div style="font-size: 2em; font-weight: bold; color: var(--primary);">{{ analysis_result.avg_rating }}</div>
            <div>å¹³å‡è©•ä¾¡</div>
        </div>
        <div style="background: #f7fafc; padding: 1rem; border-radius: 8px; text-align: center;">
            <div style="font-size: 2em; font-weight: bold; color: var(--primary);">{{ analysis_result.strength_assessment.tier }}</div>
            <div>ãƒ‡ãƒƒã‚­å¼·åº¦</div>
        </div>
    </div>
    
    <div class="alert alert-info">
        <strong>{{ analysis_result.strength_assessment.description }}</strong>
        (èª¿æ•´å¾Œè©•ä¾¡: {{ analysis_result.strength_assessment.adjusted_rating }})
    </div>
    
    <!-- ãƒãƒŠã‚«ãƒ¼ãƒ– -->
    <h4>ğŸ“ˆ ãƒãƒŠã‚«ãƒ¼ãƒ–</h4>
    <div style="background: #f9f9f9; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
        {% for cost in range(1, 8) %}
            {% set count = analysis_result.curve.get(cost, 0) %}
            <div style="display: flex; align-items: center; margin: 0.5rem 0;">
                <span style="width: 60px;">{{ cost }}ã‚³ã‚¹ãƒˆ:</span>
                <div style="background: var(--primary); height: 20px; width: {{ count * 20 }}px; margin-right: 0.5rem; border-radius: 4px;"></div>
                <span>{{ count }}æš</span>
            </div>
        {% endfor %}
    </div>
    
    <!-- å½¹å‰²åˆ†å¸ƒ -->
    {% if analysis_result.roles %}
    <h4>âš”ï¸ å½¹å‰²åˆ†å¸ƒ</h4>
    <div style="background: #f9f9f9; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
        {% for role, count in analysis_result.roles.items() %}
        <span style="display: inline-block; background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; margin: 0.25rem; font-size: 0.9em;">
            {{ role }}: {{ count }}æš
        </span>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- ã‚¯ãƒ©ã‚¹åˆ†å¸ƒ -->
    {% if analysis_result.class_distribution %}
    <h4>ğŸ¯ ã‚¯ãƒ©ã‚¹åˆ†å¸ƒ</h4>
    <div style="background: #f9f9f9; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
        {% for class_name, count in analysis_result.class_distribution.items() %}
        <span style="display: inline-block; background: var(--secondary); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; margin: 0.25rem; font-size: 0.9em;">
            {{ class_name }}: {{ count }}æš
        </span>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- æ”¹å–„ææ¡ˆ -->
    {% if analysis_result.recommendations %}
    <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ</h4>
    <ul style="margin: 1rem 0; padding-left: 2rem;">
        {% for recommendation in analysis_result.recommendations %}
        <li style="margin: 0.5rem 0;">{{ recommendation }}</li>
        {% endfor %}
    </ul>
    {% endif %}
    
    <!-- ã‚·ãƒŠã‚¸ãƒ¼åˆ†æã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    {% if analysis_result.synergy_analysis %}
    <h4>ğŸ”— ã‚·ãƒŠã‚¸ãƒ¼åˆ†æ</h4>
    <div style="background: #f9f9f9; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
        <div style="margin-bottom: 0.5rem;">
            <strong>ç·åˆã‚·ãƒŠã‚¸ãƒ¼ã‚¹ã‚³ã‚¢: {{ analysis_result.synergy_analysis.synergy_score }}</strong>
        </div>
        {% if analysis_result.synergy_analysis.synergies %}
            {% for synergy_name, synergy_data in analysis_result.synergy_analysis.synergies.items() %}
            <div style="margin: 0.5rem 0;">
                <span style="display: inline-block; background: var(--success); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; margin-right: 0.5rem;">
                    {{ synergy_name }}
                </span>
                <small>åŸºç›¤: {{ synergy_data.enablers }}æš, æ´»ç”¨: {{ synergy_data.payoffs }}æš</small>
            </div>
            {% endfor %}
        {% else %}
            <p>æ¤œå‡ºã•ã‚ŒãŸã‚·ãƒŠã‚¸ãƒ¼ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
        {% endif %}
    </div>
    {% endif %}

    <!-- ã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—åˆ†æã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    {% if analysis_result.archetype_analysis %}
    <h4>ğŸ¯ ã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—åˆ†æ</h4>
    <div class="alert alert-info">
        {% if analysis_result.archetype_analysis.detected_archetype %}
        <strong>æ¤œå‡º: {{ analysis_result.archetype_analysis.detected_archetype }}</strong>
        ï¼ˆä¿¡é ¼åº¦: {{ analysis_result.archetype_analysis.confidence }}%ï¼‰<br>
        {{ analysis_result.archetype_analysis.get('archetype_description', '') }}
        {% else %}
        æ˜ç¢ºãªã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ãƒãƒ©ãƒ³ã‚¹å‹ãƒ‡ãƒƒã‚­ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚
        {% endif %}
    </div>

    {% if analysis_result.archetype_analysis.recommendations %}
    <h5>æˆ¦ç•¥çš„æ¨å¥¨äº‹é …:</h5>
    <ul style="margin: 1rem 0; padding-left: 2rem;">
        {% for recommendation in analysis_result.archetype_analysis.recommendations %}
        <li style="margin: 0.5rem 0;">{{ recommendation }}</li>
        {% endfor %}
    </ul>
    {% endif %}
    {% endif %}

    
    <!-- è§£æ±ºã§ããªã‹ã£ãŸã‚«ãƒ¼ãƒ‰ -->
    {% if analysis_result.unresolved_cards %}
    <div class="alert alert-warning">
        <strong>è§£æ±ºã§ããªã‹ã£ãŸã‚«ãƒ¼ãƒ‰:</strong> {{ ', '.join(analysis_result.unresolved_cards) }}
    </div>
    {% endif %}
</div>
{% endif %}
{% endblock %}
